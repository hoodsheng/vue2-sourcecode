{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组中的部分方法\nlet oldArrayProtoMethods = Array.prototype;\n// 拷贝数组原型上的方法\nexport let newArrayProto = Object.create(oldArrayProtoMethods);\n// 改变原数组的方法\nlet methods = [\"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"splice\"];\n\nmethods.forEach((method) => {\n  // arr.push(1,2,3)\n  newArrayProto[method] = function (...args) {\n    // 重写方法\n    const result = oldArrayProtoMethods[method].call(this, ...args); // 内部调用原来的方法，函数的劫持\n    // console.log(method);\n\n    const ob = this.__ob__;\n    // 如果新增的是对象，就需要再次对它劫持\n    let inserted; //新增的数据\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        // arr.push(1,2,3)\n        inserted = args;\n        break;\n      case \"splice\":\n        // arr.slice(0,1,{a:1},{a;2})\n        inserted = args.slice(2);\n      default:\n        break;\n    }\n    if (inserted) ob.observeArray(inserted);\n    return result;\n  };\n});\n","import { newArrayProto } from \"./array\";\n\nclass Observer {\n  // 观测值\n  constructor(data) {\n    // 将Observer的实例变成data的自定义属性__ob__\n    // 如果data为对象，将无限被监控，形成死递归（笑死）\n    // data.__ob__ = this;\n    Object.defineProperty(data, \"__ob__\", {\n      enumerable: false, // 不可枚举（循环的时候无法获取到）\n      value: this,\n    });\n    // 判断是否为数组\n    if (Array.isArray(data)) {\n      // 保留数组原有方法，重写部分方法\n      data.__proto__ = newArrayProto; // 重写数组原型方法\n      this.observeArray(data);\n    } else {\n      // Object.defineProperty只能劫持已经存在属性，后增，或者删除的它都不知道\n      this.walk(data);\n    }\n  }\n  // 观测对象属性\n  walk(data) {\n    // 让对象上的所有属性依次进行观测\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\n  }\n  // 观测数组\n  observeArray(data) {\n    // 监控数组中的对象\n    data.forEach((item) => observe(item));\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  // 如果value为对象，就再次劫持数据\n  observe(value);\n  Object.defineProperty(data, key, {\n    get() {\n      console.log(\"取值了\");\n      return value;\n    },\n    set(newValue) {\n      if (newValue == value) return;\n      // 如果newValue为对象，就再次劫持数据\n      observe(newValue);\n      value = newValue;\n      console.log(\"设置值了\");\n    },\n  });\n}\n\nexport function observe(data) {\n  // console.log(data);\n  // 如果是null或者不是对象就不需要劫持\n  if (typeof data !== \"object\" || data == null) {\n    return;\n  }\n  // 如果这个属性被代理过\n  if (data.__ob__ instanceof Observer) return data.__ob__;\n  // 判断一个对象是否被劫持过，可以增加一个实例\n  return new Observer(data);\n}\n","import { observe } from \"./observe/index\";\n\nexport function initState(vm) {\n  // 获取所有选项\n  const opts = vm.$options;\n  if (opts.data) {\n    // 初始化data\n    initData(vm);\n  }\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n  // data 可能是函数和对象 ,并将_data放在实例上\n  data = vm._data = typeof data === \"function\" ? data.call(vm) : data;\n  // console.log(data);\n  observe(data);\n  // 将用户访问的vm._data.xxx 转换成vm.xxx\n  for (let key in data) {\n    // 将_data上的属性全部代理给vm实例\n    proxy(vm, \"_data\", key);\n  }\n}\n\n// 数据代理\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[target][key];\n    },\n    set(newValue) {\n      vm[target][key] = newValue;\n    },\n  });\n}\n","import { initState } from \"./state\";\n\n// 初始化\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    // 将用户的实例挂载到vue实例上\n    vm.$options = options;\n    // 初始化状态（props，data，methods，watch，computed等等）\n    initState(vm);\n  };\n}\n","import { initMixin } from \"./init\";\n\n// options用户传入的选项\nfunction Vue(options) {\n  // debugger;\n  this._init(options);\n}\n\n// 扩展init方法\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["oldArrayProtoMethods","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","ob","__ob__","inserted","slice","observeArray","Observer","data","defineProperty","enumerable","value","isArray","__proto__","walk","keys","key","defineReactive","item","observe","get","console","log","set","newValue","initState","vm","opts","$options","initData","_data","proxy","target","initMixin","Vue","_init","options"],"mappings":"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"}